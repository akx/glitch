/**
 * dat-gui JavaScript Controller Library
 * http://code.google.com/p/dat-gui
 *
 * Copyright 2011 Data Arts Team, Google Creative Lab
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*

	StackBlur - a fast almost Gaussian Blur For Canvas

	Version: 	0.5
	Author:		Mario Klingemann
	Contact: 	mario@quasimondo.com
	Website:	http://www.quasimondo.com/StackBlurForCanvas
	Twitter:	@quasimondo

	In case you find this class useful - especially in commercial projects -
	I am not totally unhappy for a small donation to my PayPal account
	mario@quasimondo.de

	Or support me on flattr:
	https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

	Copyright (c) 2010 Mario Klingemann

	Permission is hereby granted, free of charge, to any person
	obtaining a copy of this software and associated documentation
	files (the "Software"), to deal in the Software without
	restriction, including without limitation the rights to use,
	copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the
	Software is furnished to do so, subject to the following
	conditions:

	The above copyright notice and this permission notice shall be
	included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	OTHER DEALINGS IN THE SOFTWARE.
	*/

function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,t){t=t||document;var n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){t=t||document;var n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){var n=t.call(arguments);for(var r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(t,n,r){if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===t.length+0){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i)===this.BREAK)return}else for(var i in t)if(n.call(r,t[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}(),dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=undefined,this.__onFinishChange=undefined};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(dat.utils.common),dat.dom.dom=function(e){function i(t){if(t==="0"||e.isUndefined(t))return 0;var n=t.match(r);return e.isNull(n)?0:parseFloat(n[1])}var t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},n={};e.each(t,function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/,s={makeSelectable:function(e,t){if(e===undefined||e.style===undefined)return;e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off"},makeFullscreen:function(t,n,r){e.isUndefined(n)&&(n=!0),e.isUndefined(r)&&(r=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,i,s){i=i||{};var o=n[r];if(!o)throw new Error("Event type "+r+" not supported.");var u=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0,f=i.y||i.clientY||0;u.initMouseEvent(r,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,f,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=u.initKeyboardEvent||u.initKeyEvent;e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:undefined,charCode:undefined}),l(r,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:u.initEvent(r,i.bubbles||!1,i.cancelable||!0)}e.defaults(u,s),t.dispatchEvent(u)},bind:function(e,t,n,r){return r=r||!1,e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n),s},unbind:function(e,t,n,r){return r=r||!1,e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n),s},addClass:function(e,t){if(e.className===undefined)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return s},removeClass:function(e,t){if(t){if(e.className!==undefined)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))}}else e.className=undefined;return s},hasClass:function(e,t){return(new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)")).test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return s}(dat.utils.common),dat.controllers.OptionController=function(e,t,n){var r=function(e,i,s){r.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(n.isArray(s)){var u={};n.each(s,function(e){u[e]=e}),s=u}n.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),this.domElement.appendChild(this.__select)};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t},updateDisplay:function(){return this.__select.value=this.getValue(),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,t){function r(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var n=function(e,i,s){n.superclass.call(this,e,i),s=s||{},this.__min=s.min,this.__max=s.max,this.__step=s.step,t.isUndefined(this.__step)?this.initialValue==0?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=r(this.__impliedStep)};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return this.__min!==undefined&&e<this.__min?e=this.__min:this.__max!==undefined&&e>this.__max&&(e=this.__max),this.__step!==undefined&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,t,n){function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var r=function(e,i,s){function a(){var e=parseFloat(o.__input.value);n.isNaN(e)||o.setValue(e)}function f(){a(),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){t.bind(window,"mousemove",c),t.bind(window,"mouseup",h),u=e.clientY}function c(e){var t=u-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),u=e.clientY}function h(){t.unbind(window,"mousemove",c),t.unbind(window,"mouseup",h)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,s);var o=this,u;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",a),t.bind(this.__input,"blur",f),t.bind(this.__input,"mousedown",l),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,t,n,r,i){function o(e,t,n,r,i){return r+(i-r)*((e-t)/(n-t))}var s=function(e,n,r,i,u){function f(e){t.bind(window,"mousemove",l),t.bind(window,"mouseup",c),l(e)}function l(e){e.preventDefault();var n=t.getOffset(a.__background),r=t.getWidth(a.__background);return a.setValue(o(e.clientX,n.left,n.left+r,a.__min,a.__max)),!1}function c(){t.unbind(window,"mousemove",l),t.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}s.superclass.call(this,e,n,{min:r,max:i,step:u});var a=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",f),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return s.superclass=e,s.useDefaultStyles=function(){n.inject(i)},r.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=e*100+"%",s.superclass.prototype.updateDisplay.call(this)}}),s}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var s=this;this.__button=document.createElement("div"),this.__button.innerHTML=i===undefined?"Fire":i,t.bind(this.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return r.superclass=e,n.extend(r.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,t,n){var r=function(e,n){function s(){i.setValue(!i.__prev)}r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",s,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var n=t.hex.toString(16);while(n.length<6)n="0"+n;return"#"+n}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common),dat.color.interpret=function(e,t){var n,r,i=function(){r=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(s,function(i){if(i.litmus(e))return t.each(i.conversions,function(i,s){n=i.read(e);if(r===!1&&n!==!1)return r=n,n.conversionName=s,n.conversion=i,t.BREAK}),t.BREAK}),r},s=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!=3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!=4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return i}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function C(e,t,n,s){if(t[n]===undefined)throw new Error("Object "+t+' has no property "'+n+'"');var o;if(s.color)o=new l(t,n);else{var u=[t,n].concat(s.factoryArgs);o=r.apply(e,u)}s.before instanceof i&&(s.before=s.before.__li),A(e,o),p.addClass(o.domElement,"c");var a=document.createElement("span");p.addClass(a,"property-name"),a.innerHTML=o.property;var f=document.createElement("div");f.appendChild(a),f.appendChild(o.domElement);var c=k(e,f,s.before);return p.addClass(c,N.CLASS_CONTROLLER_ROW),p.addClass(c,typeof o.getValue()),L(e,c,o),e.__controllers.push(o),o}function k(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,params.before):e.__ul.appendChild(r),e.onResize(),r}function L(e,t,n){n.__li=t,n.__gui=e,d.extend(n,{options:function(t){if(arguments.length>1)return n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]});if(d.isArray(t)||d.isObject(t))return n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}});if(n instanceof a){var r=new u(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),i.apply(r,e)}}),p.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof u){var i=function(t){return d.isNumber(n.__min)&&d.isNumber(n.__max)?(n.remove(),C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=d.compose(i,n.min),n.max=d.compose(i,n.max)}else n instanceof s?(p.bind(t,"click",function(){p.fakeEvent(n.__checkbox,"click")}),p.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof o?(p.bind(t,"click",function(){p.fakeEvent(n.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(n.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(n.__button,"hover")})):n instanceof l&&(p.addClass(t,"color"),n.updateDisplay=d.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=d.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&j(e.getRoot(),!0),t},n.setValue)}function A(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(r!=-1){var i=n.__rememberedObjectIndecesToControllers[r];i===undefined&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t;if(n.load&&n.load.remembered){var s=n.load.remembered,o;if(s[e.preset])o=s[e.preset];else{if(!s[y])return;o=s[y]}if(o[r]&&o[r][t.property]!==undefined){var u=o[r][t.property];t.initialValue=u,t.setValue(u)}}}}function O(e,t){return document.location.href+"."+t}function M(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),p.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",p.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",p.addClass(r,"button"),p.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",p.addClass(i,"button"),p.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",p.addClass(s,"button"),p.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?d.each(e.load.remembered,function(t,n){H(e,n,n==e.preset)}):H(e,y,!1),p.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s);if(b){var u=document.getElementById("dg-save-locally"),a=document.getElementById("dg-local-explain");u.style.display="block";var f=document.getElementById("dg-local-storage");localStorage.getItem(O(e,"isLocal"))==="true"&&f.setAttribute("checked","checked");function l(){a.style.display=e.useLocalStorage?"block":"none"}l(),p.bind(f,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var c=document.getElementById("dg-new-constructor");p.bind(c,"keydown",function(e){e.metaKey&&(e.which===67||e.keyCode==67)&&w.hide()}),p.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),undefined,2),w.show(),c.focus(),c.select()}),p.bind(r,"click",function(){e.save()}),p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(s,"click",function(){e.revert()})}function _(e){function n(n){return n.preventDefault(),t=n.clientX,p.addClass(e.__closeButton,N.CLASS_DRAG),p.bind(window,"mousemove",r),p.bind(window,"mouseup",i),!1}function r(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function i(){p.removeClass(e.__closeButton,N.CLASS_DRAG),p.unbind(window,"mousemove",r),p.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div"),d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var t;p.bind(e.__resize_handle,"mousedown",n),p.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function D(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function P(e,t){var n={};return d.each(e.__rememberedObjects,function(r,i){var s={},o=e.__rememberedObjectIndecesToControllers[i];d.each(o,function(e,n){s[n]=t?e.initialValue:e.getValue()}),n[i]=s}),n}function H(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function B(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value==e.preset&&(e.__preset_select.selectedIndex=t)}function j(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];t?n.innerHTML=n.value+"*":n.innerHTML=n.value}function F(e){e.length!=0&&c(function(){F(e)}),d.each(e,function(e){e.updateDisplay()})}e.inject(n);var v="dg",m=72,g=20,y="Default",b=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}}(),w,E=!0,S,x=!1,T=[],N=function(e){function u(){localStorage.setItem(O(t,"gui"),JSON.stringify(t.getSaveObject()))}function f(){var e=t.getRoot();e.width+=1,d.defer(function(){e.width-=1})}var t=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,v),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=d.defaults(e,{autoPlace:!0,width:N.DEFAULT_WIDTH}),e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),d.isUndefined(e.load)?e.load={preset:y}:e.preset&&(e.load.preset=e.preset),d.isUndefined(e.parent)&&e.hideable&&T.push(this),e.resizable=d.isUndefined(e.parent)&&e.resizable,e.autoPlace&&d.isUndefined(e.scrollable)&&(e.scrollable=!0);var n=b&&localStorage.getItem(O(this,"isLocal"))==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return t.parent?t.getRoot().preset:e.load.preset},set:function(n){t.parent?t.getRoot().preset=n:e.load.preset=n,B(this),t.revert()}},width:{get:function(){return e.width},set:function(n){e.width=n,D(t,n)}},name:{get:function(){return e.name},set:function(t){e.name=t,i&&(i.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(n){e.closed=n,e.closed?p.addClass(t.__ul,N.CLASS_CLOSED):p.removeClass(t.__ul,N.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=n?N.TEXT_OPEN:N.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return n},set:function(e){b&&(n=e,e?p.bind(window,"unload",u):p.unbind(window,"unload",u),localStorage.setItem(O(t,"isLocal"),e))}}});if(d.isUndefined(e.parent)){e.closed=!1,p.addClass(this.domElement,N.CLASS_MAIN),p.makeSelectable(this.domElement,!1);if(b&&n){t.useLocalStorage=!0;var r=localStorage.getItem(O(this,"gui"));r&&(e.load=JSON.parse(r))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=N.TEXT_CLOSED,p.addClass(this.__closeButton,N.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{e.closed===undefined&&(e.closed=!0);var i=document.createTextNode(e.name);p.addClass(i,"controller-name");var s=k(t,i),o=function(e){return e.preventDefault(),t.closed=!t.closed,!1};p.addClass(this.__ul,N.CLASS_CLOSED),p.addClass(s,"title"),p.bind(s,"click",o),e.closed||(this.closed=!1)}e.autoPlace&&(d.isUndefined(e.parent)&&(E&&(S=document.createElement("div"),p.addClass(S,v),p.addClass(S,N.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(S),E=!1),S.appendChild(this.domElement),p.addClass(this.domElement,N.CLASS_AUTO_PLACE)),this.parent||D(t,e.width)),p.bind(window,"resize",function(){t.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){t.onResize()}),p.bind(this.__ul,"transitionend",function(){t.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){t.onResize()}),this.onResize(),e.resizable&&_(this);var a=t.getRoot();e.parent||f()};return N.toggleHide=function(){x=!x,d.each(T,function(e){e.domElement.style.zIndex=x?-999:999,e.domElement.style.opacity=x?0:1})},N.CLASS_AUTO_PLACE="a",N.CLASS_AUTO_PLACE_CONTAINER="ac",N.CLASS_MAIN="main",N.CLASS_CONTROLLER_ROW="cr",N.CLASS_TOO_TALL="taller-than-window",N.CLASS_CLOSED="closed",N.CLASS_CLOSE_BUTTON="close-button",N.CLASS_DRAG="drag",N.DEFAULT_WIDTH=245,N.TEXT_CLOSED="Close Controls",N.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){document.activeElement.type!=="text"&&(e.which===m||e.keyCode==m)&&N.toggleHide()},!1),d.extend(N.prototype,{add:function(e,t){return C(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return C(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&S.removeChild(this.domElement)},addFolder:function(e){if(this.__folders[e]!==undefined)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new N(t);this.__folders[e]=n;var r=k(this,n.domElement);return p.addClass(r,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,n=0;d.each(e.__ul.childNodes,function(t){if(!e.autoPlace||t!==e.__save_row)n+=p.getHeight(t)}),window.innerHeight-t-g<n?(p.addClass(e.domElement,N.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-g+"px"):(p.removeClass(e.domElement,N.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){d.isUndefined(w)&&(w=new h,w.domElement.innerHTML=t);if(this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;d.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length==0&&M(e),e.__rememberedObjects.indexOf(t)==-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&D(this,this.width)},getRoot:function(){var e=this;while(e.parent)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=P(this)),e.folders={},d.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=P(this),j(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[y]=P(this,!0)),this.load.remembered[e]=P(this),this.preset=e,H(this,e,!0)},revert:function(e){d.each(this.__controllers,function(t){this.getRoot().load.remembered?A(e||this.getRoot(),t):t.setValue(t.initialValue)},this),d.each(this.__folders,function(e){e.revert(e)}),e||j(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e),t&&F(this.__listening)}}),N}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(e,t,n,r,i,s,o){return function(u,a){var f=u[a];if(o.isArray(arguments[2])||o.isObject(arguments[2]))return new e(u,a,arguments[2]);if(o.isNumber(f))return o.isNumber(arguments[2])&&o.isNumber(arguments[3])?new n(u,a,arguments[2],arguments[3]):new t(u,a,{min:arguments[2],max:arguments[3]});if(o.isString(f))return new r(u,a);if(o.isFunction(f))return new i(u,a,"");if(o.isBoolean(f))return new s(u,a)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var r=function(e,n){function s(){i.setValue(i.__input.value)}function o(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}r.superclass.call(this,e,n);var i=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",s),t.bind(this.__input,"change",s),t.bind(this.__input,"blur",o),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,r,i){function u(e,t,n,r){e.style.background="",i.each(o,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function a(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var s=function(e,o){function c(e){v(e),t.bind(window,"mousemove",v),t.bind(window,"mouseup",h)}function h(){t.unbind(window,"mousemove",v),t.unbind(window,"mouseup",h)}function p(){var e=r(this.value);e!==!1?(f.__color.__state=e,f.setValue(f.__color.toOriginal())):this.value=f.__color.toString()}function d(){t.unbind(window,"mousemove",m),t.unbind(window,"mouseup",d)}function v(e){e.preventDefault();var n=t.getWidth(f.__saturation_field),r=t.getOffset(f.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/n,s=1-(e.clientY-r.top+document.body.scrollTop)/n;return s>1?s=1:s<0&&(s=0),i>1?i=1:i<0&&(i=0),f.__color.v=s,f.__color.s=i,f.setValue(f.__color.toOriginal()),!1}function m(e){e.preventDefault();var n=t.getHeight(f.__hue_field),r=t.getOffset(f.__hue_field),i=1-(e.clientY-r.top+document.body.scrollTop)/n;return i>1?i=1:i<0&&(i=0),f.__color.h=i*360,f.setValue(f.__color.toOriginal()),!1}s.superclass.call(this,e,o),this.__color=new n(this.getValue()),this.__temp=new n(0);var f=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){e.keyCode===13&&p.call(this)}),t.bind(this.__input,"blur",p),t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(f.__selector,"drag")})});var l=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(l.style,{width:"100%",height:"100%",background:"none"}),u(l,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),a(this.__hue_field),i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",c),t.bind(this.__field_knob,"mousedown",c),t.bind(this.__hue_field,"mousedown",function(e){m(e),t.bind(window,"mousemove",m),t.bind(window,"mouseup",d)}),this.__saturation_field.appendChild(l),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};s.superclass=e,i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(e!==!1){var t=!1;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,o=255-s;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,u(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];return s}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,r){function s(e,t,n){Object.defineProperty(e,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(u(this,t,n),this.__state[t])},set:function(e){this.__state.space!=="RGB"&&(u(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(a(this),this.__state[t])},set:function(e){this.__state.space!=="HSV"&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function u(e,n,i){if(e.__state.space==="HEX")e.__state[n]=t.component_from_hex(e.__state.hex,i);else{if(e.__state.space!=="HSV")throw"Corrupted color state";r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v}),r.isNaN(n.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var i=function(){this.__state=e.apply(this,arguments);if(this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],r.extend(i.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),s(i.prototype,"r",2),s(i.prototype,"g",1),s(i.prototype,"b",0),o(i.prototype,"h"),o(i.prototype,"s"),o(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(i.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),i}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),s=n*(1-t),o=n*(1-i*t),u=n*(1-(1-i)*t),a=[[n,u,s],[o,n,s],[s,n,u],[s,o,n],[u,s,n],[n,s,o]][r];return{r:a[0]*255,g:a[1]*255,b:a[2]*255}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),s=i-r,o,u;return i==0?{h:NaN,s:0,v:0}:(u=s/i,e==i?o=(t-n)/s:t==i?o=2+(n-e)/s:o=4+(e-t)/s,o/=6,o<0&&(o+=1),{h:o*360,s:u,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n),r},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,n,r){return r<<(e=n*8)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){function r(e){console.log(e)}var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../almond",function(){}),define("module_base",[],function(){var e,t,n,r,i,s,o;return e={},t={},n=function(t,n,r){e[t]={name:t,params:n,action:r}},r=function(n){var r,i,s,o,u,a,f,l,c,h,p;for(r in i=e){s=i[r],o=n.addFolder(r),u=t[r]||(t[r]={});for(a=0,l=(f=s.params).length;a<l;++a){c=f[a];if(c.type=="num"||c.type=="int"){u[c.name]=c.value||0,h=o.add(u,c.name,c.min,c.max),(p=c.step)&&h.step(p);continue}if(c.type=="bool"){u[c.name]=!!c.value||!1,o.add(u,c.name);continue}}}},i=function(e,t){return import$({type:"num",name:e,min:0,max:1,step:null,value:0},t||{})},s=function(e,t){return import$({type:"int",name:e,min:0,max:1,step:1,value:0},t||{})},o=function(e,t){return{type:"bool",name:e,value:t!=null&&!!t.value}},{modules:e,settings:t,Module:n,Num:i,Bool:o,Int:s,addModulesToGUI:r}}),define("utils",[],function(){var e,t,n,r,i,s,o,u,a;return e=function(e,t,n){return n==null&&(n=.5),t*n+e*(1-n)},t={_a:function(e,t){return e},_b:function(e,t){return t}},n=function(e){var n,r,i;return e<=0?t._a:e>=1?t._b:(n=0|e*100,(r=t[n])?r:(i=1-e,t[n]=new Function("a","b","return b * "+e+" + a * "+i)))},r=function(e,t){while(e<0)e+=t;return e%t},i=function(e,t){return e<0?0:e>=t?t:e},s=function(e,t){return 0|Math.random()*(t-e)+e},o=function(e,t){return 0|(Math.random()*(t-e)+e)*(Math.random()<=.5?-1:1)},u=function(e,t){return e==null&&(e=0),t==null&&(t=1),Math.random()*(t-e)+e},a=function(e,t){return e<0&&(e+=(1|e/-t)*t),0|e%t},{lerper:n,lerp:e,zwrap:r,zclamp:i,birandint:o,randint:s,rand:u,mmod:a}}),define("blend",[],function(){function e(e,t,n,r,i){var s=e.data,o=t.data,u=o.length,a,f,l,c,h,p,d,v;d=n+r-n*r;for(var m=0;m<u;m+=4){a=s[m]/255*n,c=o[m]/255*r,f=s[m+1]/255*n,h=o[m+1]/255*r,l=s[m+2]/255*n,p=o[m+2]/255*r,v=255/d;switch(i){case"normal":case"src-over":o[m]=(a+c-c*n)*v,o[m+1]=(f+h-h*n)*v,o[m+2]=(l+p-p*n)*v;break;case"screen":o[m]=(a+c-a*c)*v,o[m+1]=(f+h-f*h)*v,o[m+2]=(l+p-l*p)*v;break;case"multiply":o[m]=(a*c+a*(1-r)+c*(1-n))*v,o[m+1]=(f*h+f*(1-r)+h*(1-n))*v,o[m+2]=(l*p+l*(1-r)+p*(1-n))*v;break;case"difference":o[m]=(a+c-2*Math.min(a*r,c*n))*v,o[m+1]=(f+h-2*Math.min(f*r,h*n))*v,o[m+2]=(l+p-2*Math.min(l*r,p*n))*v;break;case"src-in":d=n*r,v=255/d,o[m+3]=d*255,o[m]=a*r*v,o[m+1]=f*r*v,o[m+2]=l*r*v;break;case"plus":case"add":o[m]=Math.min(a+c,1)*v,o[m+1]=Math.min(f+h,1)*v,o[m+2]=Math.min(l+p,1)*v;break;case"overlay":o[m]=c<=.5?2*s[m]*c/r:255-(2-2*c/r)*(255-s[m]),o[m+1]=h<=.5?2*s[m+1]*h/r:255-(2-2*h/r)*(255-s[m+1]),o[m+2]=p<=.5?2*s[m+2]*p/r:255-(2-2*p/r)*(255-s[m+2]);break;case"hardlight":o[m]=a<=.5?2*o[m]*a/r:255-(2-2*a/n)*(255-o[m]),o[m+1]=f<=.5?2*o[m+1]*f/r:255-(2-2*f/n)*(255-o[m+1]),o[m+2]=l<=.5?2*o[m+2]*l/r:255-(2-2*l/n)*(255-o[m+2]);break;case"colordodge":case"dodge":s[m]==255&&c==0?o[m]=255:o[m]=Math.min(255,o[m]/(255-s[m]))*v,s[m+1]==255&&h==0?o[m+1]=255:o[m+1]=Math.min(255,o[m+1]/(255-s[m+1]))*v,s[m+2]==255&&p==0?o[m+2]=255:o[m+2]=Math.min(255,o[m+2]/(255-s[m+2]))*v;break;case"colorburn":case"burn":s[m]==0&&c==0?o[m]=0:o[m]=(1-Math.min(1,(1-c)/a))*v,s[m+1]==0&&h==0?o[m+1]=0:o[m+1]=(1-Math.min(1,(1-h)/f))*v,s[m+2]==0&&p==0?o[m+2]=0:o[m+2]=(1-Math.min(1,(1-p)/l))*v;break;case"darken":case"darker":o[m]=(a>c?c:a)*v,o[m+1]=(f>h?h:f)*v,o[m+2]=(l>p?p:l)*v;break;case"lighten":case"lighter":o[m]=(a<c?c:a)*v,o[m+1]=(f<h?h:f)*v,o[m+2]=(l<p?p:l)*v;break;case"exclusion":o[m]=(c+a-2*c*a)*v,o[m+1]=(h+f-2*h*f)*v,o[m+2]=(p+l-2*p*l)*v;break;default:o[m]=o[m+3]=255,o[m+1]=m%8==0?255:0,o[m+2]=m%8==0?0:255}}}return{dataBlend:e}}),define("StackBlur",[],function(){function n(n,i,s,o,u,a){if(isNaN(a)||a<1)return;a|=0;var f=n.data,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=a+a+1,M=o<<2,_=o-1,D=u-1,P=a+1,H=P*(P+1)/2,B=new r,j=B;for(h=1;h<O;h++){j=j.next=new r;if(h==P)var F=j}j.next=B;var I=null,q=null;m=v=0;var R=e[a],U=t[a];for(c=0;c<u;c++){x=T=N=g=y=b=0,w=P*(C=f[v]),E=P*(k=f[v+1]),S=P*(L=f[v+2]),g+=H*C,y+=H*k,b+=H*L,j=B;for(h=0;h<P;h++)j.r=C,j.g=k,j.b=L,j=j.next;for(h=1;h<P;h++)p=v+((_<h?_:h)<<2),g+=(j.r=C=f[p])*(A=P-h),y+=(j.g=k=f[p+1])*A,b+=(j.b=L=f[p+2])*A,x+=C,T+=k,N+=L,j=j.next;I=B,q=F;for(l=0;l<o;l++)f[v]=g*R>>U,f[v+1]=y*R>>U,f[v+2]=b*R>>U,g-=w,y-=E,b-=S,w-=I.r,E-=I.g,S-=I.b,p=m+((p=l+a+1)<_?p:_)<<2,x+=I.r=f[p],T+=I.g=f[p+1],N+=I.b=f[p+2],g+=x,y+=T,b+=N,I=I.next,w+=C=q.r,E+=k=q.g,S+=L=q.b,x-=C,T-=k,N-=L,q=q.next,v+=4;m+=o}for(l=0;l<o;l++){T=N=x=y=b=g=0,v=l<<2,w=P*(C=f[v]),E=P*(k=f[v+1]),S=P*(L=f[v+2]),g+=H*C,y+=H*k,b+=H*L,j=B;for(h=0;h<P;h++)j.r=C,j.g=k,j.b=L,j=j.next;d=o;for(h=1;h<=a;h++)v=d+l<<2,g+=(j.r=C=f[v])*(A=P-h),y+=(j.g=k=f[v+1])*A,b+=(j.b=L=f[v+2])*A,x+=C,T+=k,N+=L,j=j.next,h<D&&(d+=o);v=l,I=B,q=F;for(c=0;c<u;c++)p=v<<2,f[p]=g*R>>U,f[p+1]=y*R>>U,f[p+2]=b*R>>U,g-=w,y-=E,b-=S,w-=I.r,E-=I.g,S-=I.b,p=l+((p=c+P)<D?p:D)*o<<2,g+=x+=I.r=f[p],y+=T+=I.g=f[p+1],b+=N+=I.b=f[p+2],I=I.next,w+=C=q.r,E+=k=q.g,S+=L=q.b,x-=C,T-=k,N-=L,q=q.next,v+=o}}function r(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],t=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return{stackBlurImageData:n}}),define("contextfx",["./utils","./blend","./StackBlur"],function(e,t,n){var r,i,s,o,u;return r=e.zclamp,i=t.dataBlend,s=n.stackBlurImageData,o=function(e,t,n,r){var o,u,a,f,l;if(n<=0||t<=0)return;o=e.canvas,u=o.width,a=o.height,f=e.getImageData(0,0,u,a),l=e.getImageData(0,0,u,a),s(l,0,0,u,a,t),i(l,f,n,r,"screen"),e.putImageData(f,0,0)},u=function(e,t,n,r,s){e.afterimageData&&i(e.afterimageData,t,n,r,"screen"),e.afterimageData&&s<1?i(t,e.afterimageData,s,1-s,"normal"):(e.putImageData(t,0,0),e.afterimageData=e.getImageData(0,0,t.width,t.height))},{bloom:o,afterImage:u}}),define("datafx",["./utils"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;return t=e.lerper,n=e.lerp,r=e.randint,i=e.birandint,s=e.zwrap,o=e.rand,u=e.mmod,a=e.zclamp,f=function(e,t){var n,r,i,s,o,u;n=e.data,r=e.width,i=e.height,t==null&&(t=.7);if(t>=1)return;for(s=0;s<i;s+=2)for(o=0;o<r;++o)u=s*r*4+o*4,n[u++]*=t,n[u++]*=t,n[u++]*=t},l=function(e,n,r,i){var s,o,u,a,f,l,c,h,p,d,v;s=e.data,o=e.width,u=e.height,n==null&&(n=.5),r==null&&(r=0),i==null&&(i=0);if(n<=0)return;a=t(n),f=o*4,l=s.length;for(c=0;c<u;++c){h=c*f+r;for(p=h,d=h+f;p<d;p+=4)v=p+4+i,v>=0&&v<l&&p>=0&&p<l&&(s[p]=a(s[p],s[v]))}},c=function(e,n,i,s,o,a,f,l,c,h,p){var d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;d=r(s,o),v=r(a,f),m=r(-i,i),g=r(-i,i),y=r(h,p),b=r(l,c)/20,w=t(b),E=S=n.data,x=E.length,T=N=e.data,C=T.length,k=e.width,L=0;for(A=0,O=N.length;A<O;++A)M=m+A*d,M+=(0|M/k)*y,M=u(M,x),_=u(g+A*v,C),b>0?L=N[_]=0|w(L,S[M]):N[_]=S[M];for(A=0,D=N.length;A<D;A+=4)N[A+3]=255},h=function(e,n,r,i,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w;f=e.data,l=e.width,c=e.height,o==null&&(o=2),u==null&&(u=.2),a==null&&(a=0);if(!o)return;h=t(u),i>0?(p=0,d=l,v=1):(p=l-1,d=0,v=-1);for(m=n;m<r;++m){g=m*l*4,i+=a;for(y=p;v<0?y>d:y<d;y+=v)b=g+y*4,w=g+s(0|y+i,l)*4,o&1&&(f[b]=h(f[b],f[w])),o&2&&(f[b+1]=h(f[b+1],f[w+1])),o&4&&(f[b+2]=h(f[b+2],f[w+2]))}},p=function(e,t,n,s,o,u,a){var f,l;f=r(t,n),l=r(0,e.height-f),h(e,l,l+f,i(s,o),u,a)},d=function(e,t,n,i,s,o,u){var a,f,l,c,h,p,d;a=e.data,f=e.width,i/=100,u&&(s<=0||(s=0),o>=255||(o=255));for(l=t;l<n;++l){c=l*f*4;for(h=0;h<f;++h)Math.random()<i&&(p=c+h*4,d=r(s,o),u?(a[p++]=d,a[p++]=d,a[p++]=d):(a[p++]+=d,a[p++]+=d,a[p++]+=d))}},v=[0,0,.299,.587,.114,0,128,-0.169,-0.331,.5,0,128,.5,-0.419,.081],m=[0,0,1,0,1.4,-128,0,1,-0.343,-0.711,-128,0,1,1.765,0],g=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;n=e.data,r=e.width,i=e.height,s=0,o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],y=t[12],b=t[13],w=t[14];for(s=0,E=n.length;s<E;s+=4)S=n[s]+o,x=n[s+1]+c,T=n[s+2]+m,n[s]=a*S+f*x+l*T+u,n[s+1]=p*S+d*x+v*T+h,n[s+2]=y*S+b*x+w*T+g},y=function(e){g(e,v)},b=function(e){g(e,m)},w=function(e,t,n,r,i){var s,o,a,f,l,c,h,p,d,v;s=e.data,o=e.width,a=e.height,f=0|a*i,l=u(t*n,a+f),c=l-f;for(h=0;h<a;++h)if(c<h&&h<l){p=Math.pow((h-c)/f,2)*255*r;if(p>0){d=h*o*4;for(v=0;v<o;++v)s[d++]+=p,s[d++]+=p,s[d++]+=p,s[d++]+=p}}},E=function(e,t,n,r){var i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E;i=e.width,s=e.height,o=document.createElement("canvas"),o.width=i,o.height=s,u=o.getContext("2d"),u.drawImage(t,0,0,i,s),f=u.getImageData(0,0,i,s).data,l=e.data,c=new Uint8ClampedArray(e.data);if(n!=0||r!=0)for(h=0;h<s;++h){p=h*i*4;for(d=0;d<i;++d)v=p+d*4,m=f[v+2]/127,g=(f[v]-127)/128*n*m,y=(f[v+1]-127)/128*r*m,b=0|Math.round(d+g),w=0|Math.round(h+y),E=a(w,s)*i*4+a(b,i)*4,c[v++]=l[E++],c[v++]=l[E++],c[v++]=l[E++]}l.set(c)},{scanlines:f,leak:l,bitbang:c,sliceoffset:h,sliceglitch:p,noise:d,matrixXform:g,fromYCbCr:b,toYCbCr:y,tvscan:w,displacementMapper:E}}),define("displace",[],function(){var e;return e=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v;e==null&&(e=256),t==null&&(t=224),n=r=document.createElement("canvas"),n.width=e,n.height=t,i=s=n.getContext("2d"),i.fillStyle="black",i.fillRect(0,0,e,t),o=i.getImageData(0,0,e,t);for(u=0;u<t;++u)for(a=0;a<e;++a)f=(a/e-.5)*2,l=(u/t-.5)*2,c=1-(f*f+l*l),c=Math.cos(c*3.141/2),h=Math.atan2(l,f),p=-Math.cos(h)*125*c,d=-Math.sin(h)*125*c,v=u*e*4+a*4,o.data[v]=127+p,o.data[v+1]=127+d,o.data[v+2]=127;return i.putImageData(o,0,0),r},{createTVDisplacement:e}}),define("fx_modules",["module_base","utils","contextfx","datafx","displace"],function(e,t,n,r,i){var s,o,u;return s=t.rand,o=t.randint,u=t.mmod,e.Module("ycbcrPre",[e.Bool("enable")],function(e,t,n){e.enable&&r.toYCbCr(n)}),e.Module("ycbcrPost",[e.Bool("enable")],function(e,t,n){e.enable&&r.fromYCbCr(n)}),e.Module("leaks",[e.Num("probability"),e.Num("strength"),e.Int("nMin",{min:0,max:20}),e.Int("nMax",{min:0,max:20}),e.Int("magic1",{min:-10,max:10}),e.Int("magic2",{min:-10,max:10})],function(e,t,n){var i,u;if(s()>e.probability)return;for(i=0,u=o(e.nMin,e.nMax);i<u;++i)r.leak(n,e.strength,e.magic1,e.magic2)}),e.Module("sliceglitch",[e.Num("probability"),e.Int("nMin",{min:0,max:100,value:5}),e.Int("nMax",{min:0,max:100,value:5}),e.Bool("randChan",{value:!0}),e.Bool("chanR",{value:!0}),e.Bool("chanG",{value:!0}),e.Bool("chanB",{value:!0}),e.Int("hMin",{min:1,max:300,value:5}),e.Int("hMax",{min:1,max:300,value:23}),e.Int("offMin",{min:0,max:100,value:5}),e.Int("offMax",{min:0,max:100,value:25}),e.Int("driftProb",{min:0,max:100,value:20}),e.Int("driftMag",{min:-10,max:10,value:2})],function(e,t,n){var i,u,a,f;if(s()>e.probability)return;for(i=0,u=o(e.nMin,e.nMax);i<u;++i){a=0;if(!e.randChan||o(0,100)<33)a|=+e.chanR;if(!e.randChan||o(0,100)<33)a|=+e.chanG<<1;if(!e.randChan||o(0,100)<33)a|=+e.chanB<<2;f=o(0,100)<e.driftProb?e.driftMag:0,r.sliceglitch(n,e.hMin,e.hMax,e.offMin,e.offMax,a,1,f)}}),e.Module("noise",[e.Num("probability"),e.Int("nMin",{min:0,max:100,value:5}),e.Int("nMax",{min:0,max:100,value:5}),e.Int("hMin",{min:0,max:100,value:5}),e.Int("hMax",{min:0,max:100,value:5}),e.Int("noisiness",{min:0,max:100,value:35}),e.Int("brightnessMin",{min:-100,max:100,value:10}),e.Int("brightnessMax",{min:-100,max:100,value:50}),e.Bool("replace")],function(e,t,n){var i,u,a,f,l;if(s()>e.probability)return;for(i=0,u=o(e.nMin,e.nMax);i<u;++i)a=o(e.hMin,e.hMax),f=o(0,n.height-a),l=f+a,r.noise(n,f,l,e.noisiness,e.brightnessMin,e.brightnessMax,e.replace)}),e.Module("bitbang",[e.Num("probability"),e.Int("minStrideIn",{min:0,max:32}),e.Int("maxStrideIn",{min:0,max:32}),e.Int("minStrideOut",{min:0,max:32}),e.Int("maxStrideOut",{min:0,max:32}),e.Int("minFeedback",{min:0,max:10}),e.Int("maxFeedback",{min:0,max:10}),e.Int("minYDrift",{min:-2,max:10}),e.Int("maxYDrift",{min:-2,max:10}),e.Int("offScale",{min:0,max:100})],function(e,t,n){var i;if(s()>e.probability)return;i={width:n.width,height:n.height,data:new Uint8ClampedArray(n.data)},r.bitbang(n,i,e.offScale,e.minStrideIn,e.maxStrideIn,e.minStrideOut,e.maxStrideOut,e.minFeedback,e.maxFeedback,e.minYDrift,e.maxYDrift)}),e.Module("bloom",[e.Num("strength"),e.Int("radius",{min:0,max:10}),e.Num("counter")],function(e,t,r){if(e.radius>0&&e.strength>0)return t.putImageData(r,0,0),n.bloom(t,e.radius,e.strength,e.counter),r=t.getImageData(0,0,r.width,r.height),{data:r}}),e.Module("tvsim",[e.Bool("afterimageEnabled"),e.Num("afterimageStrengthOut"),e.Num("afterimageCounterOut"),e.Num("afterimageStrengthIn"),e.Num("scanlineStrength"),e.Num("tvscanStrength"),e.Num("tvscanSpeed"),e.Num("tvscanHeight"),e.Bool("displacementEnabled"),e.Num("displacementStrength",{min:-50,max:50})],function(e,t,s){var o;e.afterimageEnabled&&n.afterImage(t,s,e.afterimageStrengthOut,e.afterimageCounterOut,e.afterimageStrengthIn),e.tvscanStrength&&(o=+(new Date),r.tvscan(s,o,e.tvscanSpeed,e.tvscanStrength,e.tvscanHeight)),e.scanlineStrength&&r.scanlines(s,1-e.scanlineStrength),e.displacementEnabled&&(t.dismap||(t.dismap=i.createTVDisplacement()),s=r.displacementMapper(s,t.dismap,e.displacementStrength,e.displacementStrength))}),{}}),define("glitch",["module_base","fx_modules"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;n={width:320,height:240,scale:2,mode:"block",image:null,fps:30,stats:!1,pause:!1},r=function(){var e,t,r;e=s.width=0|n.width,t=s.height=0|n.height,r=s.style,r.width=e*n.scale,r.height=t*n.scale},i=s=document.createElement("canvas"),document.body.appendChild(i),o=i.getContext("2d"),r(),u=new dat.GUI,u.add(n,"width",32,1024).onFinishChange(function(){r()}),u.add(n,"height",32,1024).onFinishChange(function(){r()}),u.add(n,"scale",0,3).onFinishChange(function(){r()}),u.add(n,"mode",["block","image"]),u.add(n,"fps",0,60).step(1),u.add(n,"stats"),u.add(n,"pause"),e.addModulesToGUI(u),a=f=document.createElement("div"),a.innerHTML="<h2>Choose custom image</h2>",document.body.appendChild(a),l=c=document.createElement("input"),l.type="file",l.addEventListener("change",function(e){var t;t=new FileReader,t.onload=function(e){var t,r,i,s;if(t=(r=e.target)!=null?r.result:void 8)i=s=document.createElement("img"),i.src=t,i.onload=function(){n.image=s,n.mode="image"}},t.readAsDataURL(e.target.files[0])},!1),f.appendChild(l),h=["ycbcrPre","leaks","sliceglitch","noise","bitbang","bloom","ycbcrPost","tvsim"],p=window.performance||{},p.now=p.now||p.mozNow||p.msNow||p.oNow||p.webkitNow||function(){return(new Date).getTime()},d=function(){var t,r,i,u,a,f,l,c,d,v,m,g,y,b,w;n.mode=="image"&&n.image?o.drawImage(n.image,0,0,s.width,s.height):(o.fillStyle="#346434",o.fillRect(0,0,s.width,s.height),o.fillStyle="#FFAA00",t=+(new Date)/1e3,r=t*150%s.width,o.fillRect(r,64,115,223)),i=o.getImageData(0,0,s.width,s.height),u=[];for(a=0,l=(f=h).length;a<l;++a){c=f[a];if(d=e.modules[c])v=p.now(),m=e.settings[c]||{},g=d.action(m,o,i),i=(g!=null?g.data:void 8)||i,y=p.now(),u.push(c+": "+Math.round(1*(y-v)))}o.putImageData(i,0,0);if(n.stats){o.font="7pt arial",o.fillStyle="white",o.beginPath();for(b=0,w=u.length;b<w;++b)t=u[b],o.fillText(t,5,15+b*10)}},v=function(){n.fps<=0?requestAnimationFrame(v):setTimeout(function(){v()},1e3/n.fps),n.pause||d()},window.testDraw=m=function(){var e;console.time("draw");for(e=0;e<100;++e)d();console.timeEnd("draw")},v()}),require(["glitch"]);